var mt=Object.defineProperty;var gt=(n,t,e)=>t in n?mt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var x=(n,t,e)=>(gt(n,typeof t!="symbol"?t+"":t,e),e);function w(n){return n.length}function yt(n){throw new Error(n)}function q(n){return Promise.resolve().then(n)}function y(n,t,e=0){for(;e<w(n);)t(n[e],e),e++}function C(n){return typeof n=="string"}function b(n){return typeof n=="object"&&n!==null}function Mt(n){return Array.isArray(n)}function U(n){return typeof n=="function"}function xt(n){return n.toString().slice(0,5)==="class"}function B(n){return typeof n=="object"&&n[Symbol.toStringTag]==="Promise"}function kt(n){return n instanceof RegExp}function E(n,t){const e=new WeakSet;function s(o,i){if(b(o)&&b(i)){if(e.has(o)||e.has(i))return!0;e.add(o),e.add(i);const r=Object.keys(o),c=Object.keys(i);if(w(r)!==w(c))return!1;for(const a of r)if(!c.includes(a)||!s(o[a],i[a]))return!1;return!0}else return o===i}return s(n,t)}function F(n){return[null,void 0,!1].includes(n)}function V(){return typeof window=="object"}function bt(){return Number((Math.random()+"").slice(2)).toString(32)}function rt(n,t,e){if(typeof t=="string"&&(t=t.split(".")),t.length>1){const s=t.shift();n[s]=n[s]||{},rt(n[s],t,e)}else n[t[0]]=e}function O(n,t={},...e){t||(t={});const s={tag:n,attrs:t,children:(t.children||e).filter(o=>!F(o))};return W(n)&&!w(s.children)&&s.children.push(""),s}function J(){}function W(n){return n===J}function k(n){return b(n)&&b(n.attrs)}function P(n){return!W(n.tag)&&U(n.tag)}function Q(n){const{tag:t,attrs:e,children:s}=n,o={...e,children:s};let i=t;if(xt(t)){const c=new t(o);i=c.render.bind(c)}let r=i(o);return P(r)?Q(r):r}var $;(function(n){n.create="create",n.update="update",n.remove="remove"})($||($={}));function Z(n,t){const e=[],s=r=>Object.keys(r),o=s(n),i=s(t);for(const r of o){let d=function(m,p,u=""){if(k(m)&&k(p)){if(P(m)&&E(m,p))return rt(n,u,p),!0;u+=".children",y(m.children,(f,h)=>{const g=p.children[h];d(f,g,`${u}.${h}`)})}else return E(m,p)};const c=n[r],a=t[r],l={key:r,newValue:c,oldValue:a};if(!i.includes(r)){e.push({type:$.create,...l});continue}d(c,a,r)||(e.push({type:$.update,...l}),!b(c)&&!U(c)&&(t[r]=c))}for(const r of i)o.includes(r)||e.push({type:$.remove,key:r,newValue:n[r],oldValue:t[r]});return e}function ct(...n){const t=[];return y(n,e=>{U(e)&&(e=e()),F(e)||t.push(e)}),t.join(" ").trim().replace(/\s+/," ")}function tt(n,t){y(t,(e,s)=>{const o=n[s];o?e.replaceWith(o):e.remove()}),y(n,(e,s)=>{n[s-1].after(e)},w(t))}function Et(n,t){t.after(...n)}function _(n){y(n,t=>{t.remove()})}function et(n,t,e){if(t==="style"&&b(e)){for(const s in e)n[t][s]=e[s];return}t==="className"&&Mt(e)&&(e=ct(...e)),n[t]=e}const wt=new Map;function nt(n){for(const t of wt.values()){const e=t.get(n.attrs.key||n.tag);if(e)return e}}class N{constructor(){x(this,"instance");x(this,"count");x(this,"dataMap",new WeakMap)}setInstance(t){this.count=0,this.instance=t}fixInstance(t,e){const s=this.dataMap.get(e);s&&(this.dataMap.set(t,s),this.dataMap.delete(e))}removeInstance(t){this.dataMap.delete(t)}}function v(n){n||yt("Please set the instance first")}class Ct extends N{constructor(e){super();x(this,"option");this.option=e}use(e){const{instance:s,dataMap:o,count:i,option:r}=this;v(s);const c=o.get(s)||new Map;let a;c.has(i)||c.set(i,U(e)?e():e),a=c.get(i);const l=d=>{const m=c.get(i);if(d=U(d)?d(m):d,E(d,m))return;c.set(i,d);const{update:p}=r;p(s)};return o.set(s,c),this.count++,[a,l]}}class Rt extends N{use(t,e){const{instance:s,dataMap:o,count:i}=this;v(s);const r=o.get(s)||new Map,c=r.get(i);if(c&&e!==void 0&&E(e,c.deps))return this.count++,c.result;const a=t();return r.set(i,{result:a,deps:e}),o.set(s,r),this.count++,a}}class Nt extends N{use(t,e){const{instance:s,dataMap:o,count:i}=this;v(s);const r=o.get(s)||new Map,c=r.get(i);return c&&e!==void 0&&E(e,c.deps)?c.func:(r.set(i,{func:t,deps:e}),this.count++,t)}}class st extends N{use(t,e){const{instance:s,dataMap:o,count:i}=this;v(s);const r=o.get(s)||new Map,c=r.get(i);r.set(i,{func:t,deps:e,oldDeps:c==null?void 0:c.oldDeps,clear:c==null?void 0:c.clear}),o.set(s,r),this.count++}run(t){const e=this.dataMap.get(t);e&&e.forEach(async s=>{const{clear:o,func:i,deps:r,oldDeps:c}=s;if(r!==void 0&&E(r,c))return;o&&o();const a=i();s.clear=B(a)?await a:a,s.oldDeps=r})}runClear(t){const e=this.dataMap.get(t);e&&e.forEach(s=>{s.clear&&s.clear()})}}class vt extends N{use(t){const{instance:e,dataMap:s,count:o}=this;v(e);const i=s.get(e)||new Map;let r=i.get(o);return r||(r={current:t},i.set(o,r),s.set(e,i)),this.count++,r}}class St extends N{use(t,e,s){const{instance:o,dataMap:i,count:r}=this;if(v(o),!t)return;const c=i.get(o)||new Map,a=c.get(r);if(!a||a.deps===void 0||!E(a.deps,s)){const l=e();t.current=l,c.set(r,{expose:l,deps:s}),i.set(o,c)}else t.current=a.expose;this.count++}}class $t extends N{constructor(){super();x(this,"ctx");const e=this.fixInstance;this.fixInstance=(s,o)=>{this.ctx&&this.ctx.replace(s,o),e.call(this,s,o)}}use(e){const{instance:s}=this;return v(s),this.ctx=e,e.append(s),e.inject()}}class it extends N{constructor(e){super();x(this,"option");this.option=e}use(e,s,o){const{instance:i,dataMap:r,count:c,option:a}=this;v(i);const l=r.get(i)||new Map;if(l.has(c)){const m=l.get(c);return this.count++,[m.state,m.dispatch]}s=o?o(s):s;async function d(m){s=await e(s,m),l.set(c,{state:s,dispatch:d}),a.update(i)}return l.set(c,{state:s,dispatch:d}),r.set(i,l),this.count++,[s,d]}}const D=new Map;function qt(n,t,e){const s={id:Math.random()};function o(){D.get(s).forEach(r=>{z().compUpdate(r)})}const i=new it({update:o});return i.setInstance(s),{reducer:i,handle:n,state:t,init:e,key:s}}class It extends N{use(t){const{instance:e}=this;v(e);const{reducer:s,handle:o,state:i,init:r,key:c}=t,a=D.get(c);return a?a.add(e):D.set(c,new Set([e])),s.count=0,s.use(o,i,r)}remove(t){D.forEach(e=>{e.delete(t)})}}class Ut{constructor(t={}){x(this,"option");x(this,"fragmentMap",new Map);x(this,"treeMap",new WeakMap);this.option=t}render(t){const{intercept:e}=this.option;if(e==null||e(t),!b(t))return[document.createTextNode(t)];const{tag:s}=t;return C(s)?[this.toReals(t)]:W(s)?this.toFragment(t):this.createComp(t)}toReals(t){const{nodeMount:e}=this.option,{tag:s,attrs:o,children:i}=t,r=document.createElement(s);for(const c in o)et(r,c,o[c]);return y(i,c=>{const a=this.render(c);r.append(...a)}),e==null||e(t,r),r}toFragment(t){const e=[];return y(t.children,s=>{const o=this.render(s);e.push(...o)}),this.fragmentMap.set(t,e),e}replaceTreeMap(t,e){var o,i;(i=(o=this.option).compTreeReplace)==null||i.call(o,t,e);const s=this.treeMap.get(e);this.treeMap.set(t,s),this.treeMap.delete(e)}compTreeExec(t){const{currentCompTree:e,created:s}=this.option;e==null||e(t);const o=Q(t);return s==null||s(t,o),o}createComp(t){var i,r;const e=nt(t);if(e)return this.treeMap.set(t,e),e.nodes;const s=this.compTreeExec(t),o=this.render(s);return this.treeMap.set(t,{tree:s,nodes:o}),(r=(i=this.option).mount)==null||r.call(i,t,s,o),o}destroyComp(t,e=!0){var s,o;if(k(t))if(P(t)){const i=nt(t),r=this.treeMap.get(t),{tree:c,nodes:a}=r;if(i){e&&_(a);return}this.destroyComp(c),(o=(s=this.option).unmount)==null||o.call(s,t,a),e&&_(a),this.treeMap.delete(t)}else y(t.children,i=>{this.destroyComp(i)})}updateComp(t){const e=this.treeMap.get(t);if(!e)return;const s=this.compTreeExec(t);this.updateTree(s,e.tree,e.nodes),e.tree=s;const{mount:o}=this.option;return o&&o(t,s,e.nodes),s}updateTree(t,e,s){const o=this;if(k(t)&&k(e)){if(t.tag!==e.tag){o.destroyComp(e,!1);const r=o.render(t);return tt(r,s),r}if(W(t.tag)){const r=o.fragmentMap.get(e)||s,c=[];return y(t.children,(a,l)=>{const d=e.children[l],m=r[l];if(E(a,d)){c.push(m);return}let p=[];if(F(d)){p=o.render(a);const u=c[l-1];Et(p,u)}else{const u=o.updateTree(a,d,[m]);p.push(...u)}c.push(...p)}),y(r,a=>{a.remove()},w(t.children)),o.fragmentMap.set(t,c),o.fragmentMap.delete(e),c}if(C(t.tag)){const r=s[0],{nodeUpdate:c}=o.option;c&&c(t,e,r);const a=Z(t.attrs,e.attrs);y(a,m=>{const{type:p,key:u}=m;let f=m.newValue;p===$.remove?r.removeAttribute(u==="className"?"class":u):et(r,u,f)});const l=Z(t.children,e.children),d=[];return y(l,m=>{const{type:p,key:u,newValue:f,oldValue:h}=m,g=r.childNodes[u];if(p===$.remove)k(h)&&P(h)?o.destroyComp(h):d.push(g);else if(p===$.create){const M=o.render(f);r.append(...M)}else{let M=[g];k(h)&&(P(h)?M=o.treeMap.get(h).nodes:W(h.tag)&&(M=r.childNodes)),o.updateTree(f,h,M)}}),y(d,m=>m.remove()),s}if(P(t)){o.replaceTreeMap(t,e);const r=o.treeMap.get(t),c=o.compTreeExec(t),a=o.updateTree(c,r.tree,s);r.tree=c;const{mount:l}=this.option;return l&&l(t,c,a),a}}if(t||o.destroyComp(e,!1),F(t))return _(s),[];const i=o.render(t);return tt(i,s),i}}function jt(n,t={}){const{intercept:e,currentCompTree:s}=t;function o(a){if(e==null||e(a),!k(a))return a;const{tag:l}=a;return C(l)?i(a):W(l)?r(a.children):c(a)}function i(a){const{tag:l,attrs:d,children:m}=a;let p="";for(const u in d){let f=d[u];if(!u.startsWith("on")){if(["innerHTML","innerText","textContent"].includes(u)){m[0]=f;continue}if(u==="className"){p+=` class="${ct(...[f].flat())}"`;continue}u==="style"&&b(f)&&(f=JSON.stringify(f).slice(1,-1).replace(/"/g,"").replace(/,/g,";")),p+=` ${u}="${f}"`}}return`<${l}${p}>${r(m)}</${l}>`}function r(a){let l="";return y(a,d=>{l+=o(d)}),l}function c(a){return s==null||s(a),o(Q(a))}return o(n)}let K;function Kt(){const n={};function t(u,f){n[u]=f}const e={};function s(u,f){e[u]=f}const o={state:new Ct({update:c}),memo:new Rt,effect:new st,callback:new Nt,layoutEffect:new st,ref:new vt,expose:new St,context:new $t,reducer:new it({update:c}),store:new It},i=Object.values(o),r=new WeakMap;function c(u){const f=r.get(u)||[];f.push(1),r.set(u,f);const h=w(f);q(()=>{w(f)===h&&(a.updateComp(u),r.delete(u))})}const a=new Ut({intercept(u){if(!k(u))return;const{tag:f}=u;if(C(f)){const h=n[f];h&&(u.tag=h)}},currentCompTree(u){K=p,y(i,f=>{f.setInstance(u)})},compTreeReplace(u,f){y(i,h=>{h.fixInstance(u,f)})},created(u,f){o.effect.run(u)},mount(u,f,h){o.layoutEffect.run(u)},unmount(u,f){o.effect.runClear(u),o.layoutEffect.runClear(u),o.store.remove(u),y(i,h=>{h.removeInstance(u)})},nodeMount(u,f){const{ref:h,...g}=u.attrs;h&&(h.current=f),l(g,f)},nodeUpdate(u,f,h){q(()=>{const{ref:g,...M}=u.attrs;l(M,h)})}});function l(u,f){for(const h in u){const g=e[h];g&&g(u[h],f)}}function d(u){return a.render(u)}let m;const p={useComponent:t,useDirective:s,convert:d,render(u,f){m=u;const h=d(u);return f&&f.append(...h),h},unmount(){a.destroyComp(m)},renderToString(u){return jt(u,{intercept(f){if(!k(f))return;const{tag:h,attrs:g}=f;if(C(h)){const M=n[h];if(M)return f.tag=M;for(const I in g)e[I]&&delete g[I]}},currentCompTree(f){y(i,h=>{h.setInstance(f)})}})},use(u){return u.install(p),p},compUpdate(u){return c(u)},compResult(u){return a.treeMap.get(u)}};return Object.setPrototypeOf(p,o),K=p,p}function z(){return K}function j(){return z()}const T=n=>j().state.use(n),G=(n,t)=>j().memo.use(n,t),at=(n,t)=>j().effect.use(n,t),Ht=(n,t)=>j().layoutEffect.use(n,t),Bt=n=>j().ref.use(n),Vt=(n,t,e)=>j().expose.use(n,t,e),Jt=n=>j().store.use(n);function Pt(n){const t={};return n.replace(/([^?&=]+)=([^&]+)/g,(e,s,o)=>t[s]=o),t}function Wt(n){return Object.keys(n).map(t=>`${t}=${n[t]}`).join("&")}function ut(n){const t=new URL("http://0.0.0.0"+n);return{fullPath:t.href.replace(t.origin,""),path:t.pathname,query:Pt(t.search),hash:t.hash.slice(1)}}function ft(n){let t="";const{path:e,query:s,hash:o}=n;return e&&(t+=e),w(Object.keys(s))>0&&(t+=`?${Wt(s)}`),o&&(t+=`#${o}`),t}const R={base:"",mode:"history",ssrDataKey:"g_initialProps"};let A;function At(n){A=ut(n)}function Qt(n){if(Object.assign(R,n),!V())return;const{href:t,origin:e,hash:s}=location,{base:o,mode:i}=R,r=i==="history"?t.replace(e+o,""):s.slice(1);At(r)}function lt(n,t){for(const e of n){const{path:s,exact:o}=e;if(kt(s)&&s.test(t)||C(s)&&(o===!1&&(t+"/").startsWith(s+"/")||t===s))return e}}class Dt{constructor(t){x(this,"option");x(this,"beforeEach");x(this,"currentRoute");t.prefix??(t.prefix="");const{beforeEach:e,fristUrl:s,...o}=t;this.beforeEach=e||((r,c,a)=>a()),this.option=o;const i=R.base;s.startsWith(i)&&this.change(s.replace(i,""))}change(t){return new Promise(e=>{const s=C(t)?t:ft(t),o=ut(s),{prefix:i,routes:r,controls:c}=this.option,a={...this.currentRoute};E(t,a)||this.beforeEach(o,a,()=>{this.currentRoute=o;const l=lt(r,o.fullPath.replace(i,""));function d(){c(l),e({to:o,from:a})}l&&l.beforeEach?l.beforeEach(o,a,()=>{d()}):d()})})}}const X=new Set;function pt(n){const t=new Dt(n);return X.add(t),t}const H=new Set;function Ft(n){return H.add(n),n(A,A),()=>{H.delete(n)}}async function ot(n,t){let e;for(const o of X.values())e=await o.change(n);if(E(e.to,e.from))return;A=e.to,H.forEach(o=>{o(e.to,e.from)});const s=e.to.fullPath;V()&&(R.mode==="history"?history[t+"State"](C(n)?{}:n.meta,null,R.base+s):location.hash=s)}function L(){return{push(n){ot(n,"push")},replace(n){ot(n,"replace")},go(n){history.go(n)},monitor:Ft,current:A}}let S={html:"",text:"",data:{},count:null,done(n){}};function ht(n){return G(()=>n.children.map(t=>t.attrs),[])}function dt(n,t){if(C(n))return n;const e=t.match(n);if(e)return e[0]}function Lt(n){n.prefix??(n.prefix="");const{prefix:t,loading:e,beforeEach:s}=n,o=ht(n),[i,r]=T(null);async function c(l,d){if(!l)return r(null);const{path:m,element:p,meta:u}=l,f=dt(m,d),h={path:t+f,meta:u},g={tag:p,attrs:h};B(p)&&(g.tag=(await p).default);const{getInitialProps:M}=p;if(U(M)){const I=window[R.ssrDataKey];b(I)&&I.hasOwnProperty(f)?(h.data=I[f],r(g),delete I[f]):(e&&r(e),M().then(Y=>{g.attrs.data=Y,r(g)}))}else r(g)}const a=G(()=>{const l=R.base+L().current.path;return pt({fristUrl:l,prefix:t,routes:o,beforeEach:s,controls(d){c(d,l)}})},[]);return at(()=>{function l(d){const m=L().current.path.replace(t,""),p=lt(o,m);c(p,m)}return window.addEventListener("popstate",l),()=>{X.delete(a),window.removeEventListener("popstate",l)}},[]),O(J,{},i)}function Ot(n){n.prefix??(n.prefix="");const{prefix:t,beforeEach:e}=n,s=ht(n),o=z(),[i]=T("r_"+bt());function r(c){q(()=>{S.text=S.text.replace(i,o.renderToString(c)),S.count--})}return G(()=>{S.count??(S.count=0),S.count++;const c=R.base+L().current.path;return pt({fristUrl:c,prefix:t,routes:s,beforeEach:e,async controls(a){if(!a)return r("");const{path:l,element:d,meta:m}=a,p=dt(l,c),u={path:t+p,meta:m},f={tag:d,attrs:u};B(d)&&(f.tag=(await d).default);const{getInitialProps:h}=f.tag;U(h)?h().then(g=>{S.data[p]=g,u.data=g,r(f)}):r(f)}})},[]),O(J,{},i)}function zt(n){return O(V()?Lt:Ot,n)}function Tt(n){}function Gt(n){const{to:t,type:e,children:s,onClick:o,className:i,...r}=n;b(t)&&(n.to=ft(t));const[c,a]=T([]),l=L();at(()=>l.monitor(m=>{const p=n.to+"/",u=m.path+"/";a([u.startsWith(p)?"active":"",u===p?"exact-active":"",...[i].flat()])}),[]);function d(m){m.preventDefault();function p(u=n.to){l[e==="replace"?"replace":"push"](u)}o?o(t,p):p()}return O("a",{...r,className:c,href:R.base+n.to,onclick:d},...s)}export{J as F,Gt as L,zt as R,Vt as a,Ht as b,T as c,qt as d,at as e,Jt as f,Tt as g,O as h,L as i,Qt as j,Kt as k,z as l,G as m,q as n,y as o,Bt as u};
