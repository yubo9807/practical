import{p as A}from"./@babel-9b7716b4.js";import{j as C,u as y,b as q,a as r,c as B,h as n,l as I,L as J}from"./pl-react-3e11a3c7.js";import{C as K,a as O,s as P,d as W,b as Y,c as _}from"./index-2b2a87b0.js";import{D as z}from"./basic-fc70e6c7.js";import{C as G,t as H,a as Q,b as X}from"./source-ece3fdcf.js";import"./debug-ddf39923.js";import"./ms-f6814399.js";import"./globals-aa9f7777.js";import"./@jridgewell-3b082fb9.js";import"./jsesc-4cfd8464.js";import"./picocolors-cddfbdbe.js";import"./js-tokens-bc2e8ff2.js";import"./marked-4b92e03d.js";const Z="page-utils-f86c23",tt="navigation-62969b",et="content-bea58d",nt="outline-690e4e",st="total-307071",d={"page-utils":"page-utils-f86c23",pageUtils:Z,navigation:tt,content:et,outline:nt,total:st};const ht=F=>{const S=C(W),[f,L]=y([]),[m,R]=y({name:"",content:""}),U=q(Q,[]);async function N(t){const{keys:e,body:i}=await U;!f.length&&L(e);const s=e.find(l=>l===t)||e[0];let a=i[s];S.state.codeLanguage==="js"&&(a=H(a)),R({name:s,content:a})}const g=I();r(()=>g.monitor(async t=>{if(!t.path.startsWith(F.path))return;const e=t.path+".ts";N(e)}),[]),r(()=>{const t=g.current.query.line;t&&setTimeout(()=>{w(Number(t))})},[]);const[$,V]=y(!0);r(()=>{if($){V(!1);return}const t=g.current.path+".ts";N(t)},[S.state.codeLanguage]);const h=q(()=>{const t=A(m.content,{sourceType:"module",plugins:["typescript"]});function e(o){const s={start:null,title:null};if(!o)return s;const a=o[o.length-1],{type:l,value:c,loc:p}=a;if(s.start=p.start.line,l==="CommentBlock"){const u=c.match(/\*(.)+(\n|\r\n)/);if(!u)return s;s.title=u[0].replace(/\*/g,"").trim()}else s.title=c.replace(/\/\//,"").trim();return s}const i=[];for(const o of t.program.body)if(o.type==="ExportNamedDeclaration"){if(["FunctionDeclaration","ClassDeclaration"].includes(o.declaration.type)){const{loc:s,declaration:a,leadingComments:l}=o,{start:c,end:p}=s,{start:u,title:b}=e(l);i.push({start:c.line,end:p.line,name:a.id.name,title:b,commentStart:u})}}else if(o.type==="FunctionDeclaration"){const{loc:s,id:a,leadingComments:l}=o,{start:c,end:p}=s,{start:u,title:b}=e(l);i.push({start:c.line,end:p.line,name:a.name,title:b,commentStart:u})}return i},[m.content]),k=B();function w(t){const e=k.current.getEl().getElementsByClassName("row-num")[0].childNodes;for(const i of e)if(i.getElementsByTagName("label")[0].textContent===t+""){P(i);break}}const E=()=>n("ul",{className:d.navigation},...f.map(t=>{const e=t.split("/")[2].replace(".ts","");return n("li",null,n(J,{to:t.split(".")[0]},e))})),v=C(Y);r(()=>{f.length&&v.dispatch({type:"menuSet",payload:E()})},[f]),r(()=>()=>{v.dispatch({type:"menuClear"})},[]),r(()=>{const t="$utils";return window[t]=X(),()=>{delete window[t]}},[]);const[j,x]=y(!1),D=B(),M=(()=>{const t=m.name.split("/")[2];return t?"$utils."+t.replace(".ts",""):"$utils."})(),T=C(_);return r(()=>{const t=Symbol("utilsConsole"),e={id:t,btn:n("div",{onclick:()=>x(!0)},"C"),layer:2};return T.dispatch({type:"btnAdd",payload:e}),()=>{T.dispatch({type:"btnRemove",payload:t})}},[]),n(O,{className:d.pageUtils},n("aside",null,E()),n("section",{className:d.content},n(K,{ref:k,value:m.content,lines:h})),n("aside",{className:d.outline},n("ul",null,...h.map(t=>n("li",{className:"text-ellipsis",onclick:()=>{const e=t.commentStart||t.start;w(e),g.replace({path:m.name.replace(".ts",""),query:{line:e+""}})}},t.title||t.name))),n("div",{className:d.total},"total: ",h.length)),n(z,{open:j,onClose:()=>{D.current.clear(),x(!1)},style:"width: 500px"},n(G,{ref:D,value:M})))};export{ht as default};
