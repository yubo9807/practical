var bt=Object.defineProperty;var Et=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>(Et(e,typeof t!="symbol"?t+"":t,n),n);function w(e){return e.length}function kt(e){throw new Error(e)}function Q(e){return Promise.resolve().then(e)}function y(e,t,n=0){for(;n<w(e);)t(e[n],n),n++}function C(e){return typeof e=="string"}function R(e){return typeof e=="object"&&e!==null}function Ct(e){return Array.isArray(e)}function $(e){return typeof e=="function"}function wt(e){return e.toString().slice(0,5)==="class"}function D(e){return typeof e=="object"&&e[Symbol.toStringTag]==="Promise"}function Rt(e){return e instanceof RegExp}function q(e,t){const n=new WeakSet;function s(r,i){if(R(r)&&R(i)){if(n.has(r)||n.has(i))return!0;n.add(r),n.add(i);const o=Object.keys(r),c=Object.keys(i);if(w(o)!==w(c))return!1;for(const u of o)if(!c.includes(u)||!s(r[u],i[u]))return!1;return!0}else return r===i}return s(e,t)}function K(e){return[null,void 0,!1].includes(e)}function T(){return typeof window=="object"}function Nt(){return Number((Math.random()+"").slice(2)).toString(32)}function it(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length>1){const s=t.shift();e[s]=e[s]||{},it(e[s],t,n)}else e[t[0]]=n}function F(e,t={},...n){t||(t={});const s={tag:e,attrs:t,children:(t.children||n).filter(r=>!K(r))};return O(e)&&!w(s.children)&&s.children.push(""),s}function G(){}function O(e){return e===G}function k(e){return R(e)&&R(e.attrs)}function I(e){return!O(e.tag)&&$(e.tag)}function X(e){const{tag:t,attrs:n,children:s}=e,r={...n,children:s};let i=t;if(wt(t)){const c=new t(r);i=c.render.bind(c)}let o=i(r);return I(o)?X(o):o}var P;(function(e){e.create="create",e.update="update",e.remove="remove"})(P||(P={}));function et(e,t){const n=[],s=o=>Object.keys(o),r=s(e),i=s(t);for(const o of r){let h=function(d,p,a=""){if(k(d)&&k(p)){if(I(d)&&q(d,p))return it(e,a,p),!0;a+=".children",y(d.children,(f,g)=>{const m=p.children[g];h(f,m,`${a}.${g}`)})}else return q(d,p)};const c=e[o],u=t[o],l={key:o,newValue:c,oldValue:u};if(!i.includes(o)){n.push({type:P.create,...l});continue}h(c,u,o)||n.push({type:P.update,...l})}for(const o of i)r.includes(o)||n.push({type:P.remove,key:o,newValue:e[o],oldValue:t[o]});return n}function at(...e){const t=[];return y(e,n=>{$(n)&&(n=n()),K(n)||t.push(n)}),t.join(" ").trim().replace(/\s+/," ")}function nt(e,t){y(t,(n,s)=>{const r=e[s];r?n.replaceWith(r):n.remove()}),y(e,(n,s)=>{e[s-1].after(n)},w(t))}function St(e,t){t.after(...e)}function J(e){y(e,t=>{t.remove()})}function st(e,t,n){if(t==="style"&&R(n)){for(const s in n)e[t][s]=n[s];return}t==="className"&&Ct(n)&&(n=at(...n)),e[t]=n}const vt=new Map;function rt(e){for(const t of vt.values()){const n=t.get(e.attrs.key||e.tag);if(n)return n}}class N{constructor(){b(this,"instance");b(this,"count");b(this,"dataMap",new WeakMap)}setInstance(t){this.count=0,this.instance=t}fixInstance(t,n){const s=this.dataMap.get(n);s&&(this.dataMap.set(t,s),this.dataMap.delete(n))}removeInstance(t){this.dataMap.delete(t)}}function S(e){e||kt("Please set the instance first")}function ut(e,t){return Object.is(e,t)}function H(e,t){if([e,t].includes(void 0))return!1;for(const n in e)if(!Object.is(e[n],t[n]))return!1;return!0}class Pt extends N{constructor(n){super();b(this,"option");this.option=n}use(n){const{instance:s,dataMap:r,count:i,option:o}=this;S(s);const c=r.get(s)||new Map;let u;c.has(i)||c.set(i,$(n)?n():n),u=c.get(i);const l=h=>{const d=c.get(i);if(h=$(h)?h(d):h,!ut(h,d))return c.set(i,h),o.update(s),h};return r.set(s,c),this.count++,[u,l]}}class $t extends N{use(t,n){const{instance:s,dataMap:r,count:i}=this;S(s);const o=r.get(s)||new Map,c=o.get(i);if(c&&H(n,c.deps))return this.count++,c.result;const u=t();return o.set(i,{result:u,deps:n}),r.set(s,o),this.count++,u}}class jt extends N{use(t,n){const{instance:s,dataMap:r,count:i}=this;S(s);const o=r.get(s)||new Map,c=o.get(i);return H(n,c.deps)?c.func:(o.set(i,{func:t,deps:n}),this.count++,t)}}class ot extends N{use(t,n){const{instance:s,dataMap:r,count:i}=this;S(s);const o=r.get(s)||new Map,c=o.get(i);o.set(i,{func:t,deps:n,oldDeps:c==null?void 0:c.oldDeps,clear:c==null?void 0:c.clear}),r.set(s,o),this.count++}run(t){const n=this.dataMap.get(t);n&&n.forEach(async s=>{const{clear:r,func:i,deps:o,oldDeps:c}=s;if(o!==void 0&&H(o,c))return;r&&r();const u=i();D(u)?u.then(l=>s.clear=l):s.clear=u,s.oldDeps=o})}runClear(t){const n=this.dataMap.get(t);n&&n.forEach(s=>{s.clear&&s.clear()})}}class Ut extends N{use(t){const{instance:n,dataMap:s,count:r}=this;S(n);const i=s.get(n)||new Map;let o=i.get(r);return o||(o={current:t},i.set(r,o),s.set(n,i)),this.count++,o}}class It extends N{use(t,n,s){const{instance:r,dataMap:i,count:o}=this;if(S(r),!t)return;const c=i.get(r)||new Map,u=c.get(o);if(!u||!H(u.deps,s)){const l=n();D(l)?l.then(h=>{t.current=h}):t.current=l,c.set(o,{expose:l,deps:s}),i.set(r,c)}else t.current=u.expose;this.count++}}class Ot extends N{constructor(){super();b(this,"ctx");const n=this.fixInstance;this.fixInstance=(s,r)=>{this.ctx&&this.ctx.replace(s,r),n.call(this,s,r)}}use(n){const{instance:s}=this;return S(s),this.ctx=n,n.append(s),n.inject()}}class ft extends N{constructor(n){super();b(this,"option");this.option=n}use(n,s,r){const{instance:i,dataMap:o,count:c,option:u}=this;S(i);const l=o.get(i)||new Map;if(l.has(c)){const d=l.get(c);return this.count++,[d.state,d.dispatch]}s=r?r(s):s;function h(d){let p=n(s,d);function a(f){return ut(s,f)||(s=f,l.set(c,{state:s,dispatch:h}),u.update(i)),s}return D(p)?p.then(f=>a(f)):a(p)}return l.set(c,{state:s,dispatch:h}),o.set(i,l),this.count++,[s,h]}}const _=new Map;function zt(e,t,n){const s={id:Math.random()};let r;function i(u){r=u}function o(){_.get(s).forEach(u=>{r.compUpdate(u)})}const c=new ft({update:o});return c.setInstance(s),{reducer:c,handle:e,state:t,init:n,key:s,bind:i}}class Wt extends N{use(t){const{instance:n}=this;S(n);const{reducer:s,handle:r,state:i,init:o,key:c,bind:u}=t;u(Y());const l=_.get(c);l?l.add(n):_.set(c,new Set([n])),s.count=0;const[h,d]=s.use(r,i,o);return{state:h,dispatch:d}}remove(t){_.forEach(n=>{n.delete(t)})}}class qt{constructor(t={}){b(this,"option");b(this,"fragmentMap",new Map);b(this,"treeMap",new WeakMap);this.option=t}render(t){const{intercept:n}=this.option;if(n==null||n(t),!R(t))return[document.createTextNode(t)];const{tag:s}=t;return C(s)?[this.toReals(t)]:O(s)?this.toFragment(t):this.createComp(t)}toReals(t){const{nodeMount:n}=this.option,{tag:s,attrs:r,children:i}=t,o=document.createElement(s);for(const c in r)st(o,c,r[c]);return y(i,c=>{const u=this.render(c);o.append(...u)}),n==null||n(t,o),o}toFragment(t){const n=[];return y(t.children,s=>{const r=this.render(s);n.push(...r)}),this.fragmentMap.set(t,n),n}replaceTreeMap(t,n){var r,i;(i=(r=this.option).compTreeReplace)==null||i.call(r,t,n);const s=this.treeMap.get(n);this.treeMap.set(t,s),this.treeMap.delete(n)}compTreeExec(t){const{currentCompTree:n,created:s}=this.option;n==null||n(t);const r=X(t);return s==null||s(t,r),r}createComp(t){var i,o;const n=rt(t);if(n)return this.treeMap.set(t,n),n.nodes;const s=this.compTreeExec(t),r=this.render(s);return this.treeMap.set(t,{tree:s,nodes:r}),(o=(i=this.option).mount)==null||o.call(i,t,s,r),r}destroyComp(t,n=!0){var s,r;if(k(t))if(I(t)){const i=rt(t),o=this.treeMap.get(t),{tree:c,nodes:u}=o;if(i){n&&J(u);return}this.destroyComp(c),(r=(s=this.option).unmount)==null||r.call(s,t,u),n&&J(u),this.treeMap.delete(t)}else y(t.children,i=>{this.destroyComp(i)})}updateComp(t){const n=this.treeMap.get(t);if(!n)return;const s=this.compTreeExec(t);this.updateTree(s,n.tree,n.nodes),n.tree=s;const{mount:r}=this.option;return r&&r(t,s,n.nodes),s}updateTree(t,n,s){const r=this;if(k(t)&&k(n)){if(t.tag!==n.tag){r.destroyComp(n,!1);const o=r.render(t);return nt(o,s),o}if(O(t.tag)){const o=r.fragmentMap.get(n)||s,c=[];return y(t.children,(u,l)=>{const h=n.children[l],d=o[l];if(q(u,h)){c.push(d);return}let p=[];if(K(h)){p=r.render(u);const a=c[l-1];St(p,a)}else{const a=r.updateTree(u,h,[d]);p.push(...a)}c.push(...p)}),y(o,u=>{u.remove()},w(t.children)),r.fragmentMap.set(t,c),r.fragmentMap.delete(n),c}if(C(t.tag)){const o=s[0],{nodeUpdate:c}=r.option;c&&c(t,n,o);const u=et(t.attrs,n.attrs);y(u,d=>{const{type:p,key:a}=d;let f=d.newValue;p===P.remove?o.removeAttribute(a==="className"?"class":a):st(o,a,f)});const l=et(t.children,n.children),h=[];return y(l,d=>{const{type:p,key:a,newValue:f,oldValue:g}=d,m=o.childNodes[a];if(p===P.remove)k(g)&&I(g)?r.destroyComp(g):h.push(m);else if(p===P.create){const x=r.render(f);o.append(...x)}else{let x=[m];k(g)&&(I(g)?x=r.treeMap.get(g).nodes:O(g.tag)&&(x=o.childNodes)),r.updateTree(f,g,x)}}),y(h,d=>d.remove()),s}if(I(t)){r.replaceTreeMap(t,n);const o=r.treeMap.get(t),c=r.compTreeExec(t),u=r.updateTree(c,o.tree,s);o.tree=c;const{mount:l}=this.option;return l&&l(t,c,u),u}}if(t||r.destroyComp(n,!1),K(t))return J(s),[];const i=r.render(t);return nt(i,s),i}}function At(e,t={}){const{intercept:n,currentCompTree:s}=t;function r(u){if(n==null||n(u),!k(u))return u;const{tag:l}=u;return C(l)?i(u):O(l)?o(u.children):c(u)}function i(u){const{tag:l,attrs:h,children:d}=u;let p="";for(const a in h){let f=h[a];if(!a.startsWith("on")){if(["innerHTML","innerText","textContent"].includes(a)){d[0]=f;continue}if(a==="className"){p+=` class="${at(...[f].flat())}"`;continue}a==="style"&&R(f)&&(f=JSON.stringify(f).slice(1,-1).replace(/"/g,"").replace(/,/g,";")),p+=` ${a}="${f}"`}}return`<${l}${p}>${o(d)}</${l}>`}function o(u){let l="";return y(u,h=>{l+=r(h)}),l}function c(u){return s==null||s(u),r(X(u))}return r(e)}let V;function Dt(){const e={};function t(a,f){e[a]=f}const n={};function s(a,f){n[a]=f}const r={state:new Pt({update:c}),memo:new $t,effect:new ot,callback:new jt,layoutEffect:new ot,ref:new Ut,expose:new It,context:new Ot,reducer:new ft({update:c}),store:new Wt},i=Object.values(r),o=new WeakMap;function c(a){const f=o.get(a)||[];f.push(1),o.set(a,f);const g=w(f);Q(()=>{w(f)===g&&(u.updateComp(a),o.delete(a))})}const u=new qt({intercept(a){if(!k(a))return;const{tag:f}=a;if(C(f)){const g=e[f];g&&(a.tag=g)}},currentCompTree(a){V=p,y(i,f=>{f.setInstance(a)})},compTreeReplace(a,f){y(i,g=>{g.fixInstance(a,f)})},created(a,f){r.effect.run(a)},mount(a,f,g){r.layoutEffect.run(a)},unmount(a,f){r.effect.runClear(a),r.layoutEffect.runClear(a),r.store.remove(a),y(i,g=>{g.removeInstance(a)})},nodeMount(a,f){const{ref:g,...m}=a.attrs;g&&(g.current=f),l(m,f)},nodeUpdate(a,f,g){Q(()=>{const{ref:m,...x}=a.attrs;l(x,g)})}});function l(a,f){for(const g in a){const m=n[g];m&&m(a[g],f)}}function h(a){return u.render(a)}let d;const p={useComponent:t,useDirective:s,convert:h,render(a,f){d=a;const g=h(a);return f&&f.append(...g),g},unmount(){u.destroyComp(d)},renderToString(a){return At(a,{intercept(f){if(!k(f))return;const{tag:g,attrs:m}=f;if(C(g)){const x=e[g];if(x)return f.tag=x;for(const M in m)n[M]&&delete m[M]}},currentCompTree(f){y(i,g=>{g.setInstance(f)})}})},use(a){return a.install(p),p},compUpdate(a){return c(a)},compResult(a){return u.treeMap.get(a)},version:"0.0.11"};return Object.setPrototypeOf(p,r),V=p,p}function Y(){return V}const j=Y,lt=e=>j().state.use(e),A=(e,t)=>j().memo.use(e,t),ht=(e,t)=>j().effect.use(e,t),Tt=(e,t)=>j().layoutEffect.use(e,t),Gt=e=>j().ref.use(e),Xt=(e,t,n)=>j().expose.use(e,t,n),Yt=(e,t,n)=>j().reducer.use(e,t,n),Zt=e=>j().store.use(e);function te(e,t,n){const s={current:{}},r=Dt().render(F(e,{ref:s,...t}),n);return s.current._nodes=r,s.current}function Ft(e){const t={};return e.replace(/([^?&=]+)=([^&]+)/g,(n,s,r)=>t[s]=r),t}function Lt(e){return Object.keys(e).map(t=>`${t}=${e[t]}`).join("&")}function dt(e){const t=new URL("http://0.0.0.0"+e);return{fullPath:t.href.replace(t.origin,""),path:t.pathname,query:Ft(t.search),hash:t.hash.slice(1)}}function pt(e){let t="";const{path:n,query:s,hash:r}=e;return n&&(t+=n),w(Object.keys(s))>0&&(t+=`?${Lt(s)}`),r&&(t+=`#${r}`),t}const E={base:"",mode:"history",ssrDataKey:"g_initialProps"};let W;function _t(e){W=dt(e)}function gt(){const{origin:e,href:t,hash:n}=location;return E.mode==="history"?t.replace(e+E.base,""):n.slice(1)}function ee(e){Object.assign(E,e),T()&&_t(gt())}function Kt(e,t){for(const n of e){const{path:s,exact:r}=n;if(Rt(s)&&s.test(t)||C(s)&&(r===!1&&(t+"/").startsWith(s+"/")||t===s))return n}}class Ht{constructor(t){b(this,"option");b(this,"beforeEach");b(this,"currentRoute");t.prefix??(t.prefix="");const{beforeEach:n,fristUrl:s,...r}=t;this.beforeEach=n||((o,c,u)=>u()),this.option=r;const i=E.base;s.startsWith(i)&&this.change(s.replace(i,""))}change(t){return new Promise(n=>{const s=C(t)?t:pt(t),r=dt(s),{prefix:i,routes:o,controls:c}=this.option,u={...this.currentRoute};q(t,u)||this.beforeEach(r,u,()=>{if(r.fullPath===u.fullPath)return;this.currentRoute=r;const l=Kt(o,r.path.replace(i,""));function h(){c(l,r),n({to:r,from:u})}l&&l.beforeEach?l.beforeEach(r,u,()=>{h()}):h()})})}}const mt=new Set;function yt(e){const t=new Ht(e);return mt.add(t),t}const z=new Set;function Bt(e){return z.add(e),e(W,W),()=>{z.delete(e)}}async function ct(e,t){C(e)||(e.path??(e.path=W.path));let n;for(const o of mt.values())n=await o.change(e);if(q(n.to,n.from)||(W=n.to,z.forEach(o=>{o(n.to,n.from)}),!T()))return;const{fullPath:s}=n.to,r=E.mode==="history"?s:"#"+s,i=C(e)?{}:e.meta;history[t+"State"](i,null,E.base+r)}function Z(){return{push(e){ct(e,"push")},replace(e){ct(e,"replace")},go(e){history.go(e)},monitor:Bt,current:W}}let v={html:"",text:"",data:{},count:null,done(e){}};function Mt(e){return A(()=>e.children.map(t=>t.attrs),[])}function xt(e,t){if(C(e))return e;const n=t.match(e);if(n)return n[0]}function Jt(e){e.prefix??(e.prefix="");const{prefix:t,loading:n,beforeEach:s}=e,r=Mt(e),[i,o]=lt(null),c=A(()=>new Set,[]);async function u(d,p){var tt;if(!d)return o(null);const{path:a,element:f,meta:g}=d,m=xt(a,p),x={path:t+m,meta:g},M={tag:f,attrs:x,children:[]};if($(f)&&!f.prototype&&(M.tag=f()),D(M.tag)?M.tag=(await M.tag).default:M.tag=f,(i==null?void 0:i.tag)===M.tag)return;c.add(a);const{getInitialProps:B}=M.tag;if($(B)){const L=window[E.ssrDataKey];R(L)&&L.hasOwnProperty(m)?(x.data=L[m],o(M),delete L[m]):(n&&o(n),B({url:p,path:a}).then(U=>{M.attrs.data=U}).catch(U=>{M.attrs.error=U}).finally(()=>{var U;o(M),(U=e.afterEach)==null||U.call(e,M.attrs.path)}))}else o(M),(tt=e.afterEach)==null||tt.call(e,M.attrs.path)}const l=Z(),h=A(()=>yt({fristUrl:E.base+l.current.fullPath,prefix:t,routes:r,beforeEach:s,controls(d,p){u(d,p.fullPath)}}),[]);return h.option.controls=(d,p)=>{u(d,p.fullPath)},ht(()=>{function d(p){const a=gt().replace(t,"");l.replace(a)}return window.addEventListener("popstate",d),()=>{c.delete(h),window.removeEventListener("popstate",d)}},[]),F(G,{},i)}function Qt(e){e.prefix??(e.prefix="");const{prefix:t,beforeEach:n}=e,s=Mt(e),r=Y(),i=A(()=>"r_"+Nt());function o(c){Q(()=>{v.text=v.text.replace(i,r.renderToString(c)),v.count--})}return A(()=>{v.count??(v.count=0),v.count++;const c=Z().current.fullPath;return yt({fristUrl:E.base+c,prefix:t,routes:s,beforeEach:n,async controls(u){if(!u)return o("");const{path:l,element:h,meta:d}=u,p=xt(l,c),a={path:t+p,meta:d},f={tag:h,attrs:a};$(h)&&!h.prototype&&(f.tag=h()),D(f.tag)?f.tag=(await f.tag).default:f.tag=h;const{getInitialProps:g}=f.tag;$(g)?g({url:c,path:l}).then(m=>{v.data[p]=m,a.data=m}).catch(m=>{a.errotr=m}).finally(()=>{o(f)}):o(f)}})},[]),F(G,{},i)}function ne(e){return F(T()?Jt:Qt,e)}function se(e){}function re(e){const{to:t,type:n,children:s,onClick:r,className:i,...o}=e;R(t)&&(e.to=pt(t));const[c,u]=lt([]),l=Z();ht(()=>l.monitor(p=>{const a=e.to+"/",f=p.path+"/";u([f.startsWith(a)?"active":"",f===a?"exact-active":"",...[i].flat()])}),[i]);function h(p){p.preventDefault();function a(f=e.to){l[n==="replace"?"replace":"push"](f)}r?r(t,a):a()}const d=E.mode==="history"?E.base+e.to:"#"+e.to;return F("a",{...o,className:c,href:d,onclick:h},...s)}export{G as F,re as L,ne as R,ht as a,A as b,Gt as c,Xt as d,Tt as e,y as f,te as g,F as h,T as i,Y as j,zt as k,Zt as l,se as m,Q as n,ee as o,Dt as p,Z as q,Yt as r,lt as u};
